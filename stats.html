<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Statistiche RPE</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans p-6">
  <div class="bg-white p-6 rounded-2xl shadow-lg max-w-4xl mx-auto">
    <h2 class="text-2xl font-bold mb-4 text-center">Statistiche RPE</h2>
    <div id="loader" class="text-center mb-4">‚è≥ Caricamento...</div>
    <canvas id="rpeChart" width="400" height="200"></canvas>
  </div>
  <script>
    const API = 'https://script.google.com/macros/s/AKfycbxf_DEDjW3Lsdbn3uIQSNr7qp9DQLsqIt34PxU5wcxS3Dmr6Fh85JO6oEzuPWg0wCMVvw/exec';

    async function caricaStat() {
      document.getElementById("loader").classList.remove("hidden");
      const res = await fetch(`${API}?action=get_stats`);
      const data = await res.json();
      const counts = {};
      data.rpe_join.forEach(r => {
        counts[r[1]] = (counts[r[1]] || 0) + 1;
      });
      const labels = Object.keys(counts);
      const values = Object.values(counts);
      new Chart(document.getElementById('rpeChart'), {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Totale RPE per Atleta',
            data: values,
            backgroundColor: 'rgba(54, 162, 235, 0.6)'
          }]
        }
      });
      document.getElementById("loader").classList.add("hidden");
    }

    caricaStat();
  </script>
</body>
</html>
